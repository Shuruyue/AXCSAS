# AXCSAS 計畫書 02：XRD 數據採集與預處理

**電鍍銅 XRD 分析系統 - 第二章**

---

## 1. XRD 數據採集

### 1.1 推薦掃描參數

針對電鍍銅薄膜的 XRD 測量設定：

| 參數 | 建議值 | 說明 |
|------|--------|------|
| 輻射源 | Cu Kα | 最常用，穿透深度適中 |
| 波長 | **1.54056 Å** (Kα₁) | AXCSAS 預設 |
| 掃描範圍 | 20° - 100° (2θ) | 涵蓋 Cu 主要峰 |
| 步進角度 | 0.02° - 0.05° | 平衡解析度與時間 |
| 積分時間 | 依雜訊調整 | 薄膜需較長時間 |
| 掃描模式 | θ-2θ | 標準對稱反射 |

### 1.2 數據格式支援

AXCSAS 系統支援以下格式：

| 格式 | 說明 | 來源 |
|------|------|------|
| `.txt` | Bruker 儀器輸出 | 最常用 |
| `.xy` | 兩欄純文字（角度、強度）| 通用 |
| `.csv` | 逗號分隔 | Excel 相容 |
| `.raw` | 部分儀器原始格式 | 需解碼 |

---

## 2. 數據平滑化 (Smoothing)

### 2.1 Savitzky-Golay Filter

採用 **Savitzky-Golay 濾波器**進行平滑化：

| 參數 | 建議值 | 說明 |
|------|--------|------|
| 窗口大小 | 5-15 點（**必須奇數**）| 依雜訊程度調整 |
| 多項式階數 | 2-3 | 保留峰形特徵 |

**優點**（相較於簡單移動平均）：
- 保留峰值位置準確性
- 保留峰形對稱性
- 較不影響半高寬測量

### 2.2 實作原理

Savitzky-Golay 利用最小平方法對局部數據進行多項式擬合：

$$y_{smoothed}[i] = \sum_{j=-m}^{m} c_j \cdot y[i+j]$$

其中 $c_j$ 為預先計算的卷積係數，$2m+1$ 為窗口大小。

---

## 3. 背景扣除 (Background Subtraction)

### 3.1 演算法選擇

AXCSAS 提供兩種背景扣除方法：

| 方法 | 適用情境 | 特點 |
|------|----------|------|
| **Sonneveld-Visser** | 複雜背景、多峰重疊 | 基於二階導數 |
| **Chebyshev 多項式** | 單調背景、峰間區域明確 | 使用者可控制階數 |

### 3.2 Sonneveld-Visser 演算法

**原理**：利用二階導數識別峰與背景

1. 計算圖譜二階導數
2. 負值區域對應繞射峰
3. 正值/零值區域對應背景點
4. 對背景點進行樣條插值

### 3.3 Chebyshev 多項式擬合

**流程**：
1. 自動識別無峰區域（基於強度閾值）
2. 以 Chebyshev 多項式擬合背景曲線
3. 從原始數據減去擬合背景

| 參數 | 建議值 |
|------|--------|
| 多項式階數 | 3-7 |
| 無峰區域選擇 | 自動或手動指定 |

> **注意**：避免過高階數導致背景擬合穿入峰底

---

## 4. Kα₂ 剝離 (Stripping)

### 4.1 雙峰問題

使用 Cu 靶 X 射線源時，同時產生 Kα₁ 與 Kα₂：

| 輻射線 | 波長 (Å) | 相對強度 |
|--------|----------|----------|
| Cu Kα₁ | **1.54056** | 2 |
| Cu Kα₂ | 1.54439 | 1 |

在高角度區域（2θ > 60°），Kα₁/Kα₂ 雙峰分裂明顯，影響 FWHM 測量。

### 4.2 Rachinger Correction

**演算法原理**：

假設 $I(K\alpha_2) = 0.5 \times I(K\alpha_1)$，進行遞迴相減：

```
For each 2θ from high to low:
    I_corrected(2θ) = I(2θ) - 0.5 × I(2θ - Δ2θ_corrected)
```

其中 $\Delta 2\theta$ 為 Kα₁ 與 Kα₂ 的角度差（約 0.1° - 0.5°，隨 2θ 變化）

### 4.3 角度差計算

Kα₁ 與 Kα₂ 的角度差由 Bragg 定律推導：

$$\Delta 2\theta = 2\theta_{K\alpha_2} - 2\theta_{K\alpha_1} = 2 \arcsin\left(\frac{\lambda_{K\alpha_2}}{\lambda_{K\alpha_1}} \sin\theta\right) - 2\theta$$

| 2θ (°) | Δ2θ (°) 近似值 |
|--------|----------------|
| 40 | 0.05 |
| 60 | 0.10 |
| 80 | 0.20 |
| 100 | 0.40 |

---

## 5. 儀器展寬校正

### 5.1 校正的必要性

實驗測得的峰寬 $\beta_{obs}$ 包含：
- **樣品展寬** $\beta_{sample}$：晶粒尺寸 + 微觀應變
- **儀器展寬** $\beta_{inst}$：光學系統幾何寬化

忽視儀器展寬會**嚴重低估**晶粒尺寸（特別是 D > 50 nm）

### 5.2 標準校正樣品

| 標準品 | 說明 |
|--------|------|
| **NIST SRM 660c** (LaB₆) | 首選，晶粒極大（無尺寸寬化）、無應變 |
| NIST SRM 640e (Si) | 替代選項 |

使用標準樣品測量各角度的儀器 FWHM，建立儀器響應曲線。

### 5.3 Caglioti 方程

儀器展寬具有**角度相依性**，使用 Caglioti 方程描述：

$$FWHM_{inst}^2 = U \tan^2\theta + V \tan\theta + W$$

**參數取得方式**：
1. 測量 LaB₆ 標準樣品的完整圖譜
2. 擬合各峰 FWHM
3. 對 $\tan^2\theta$、$\tan\theta$ 進行多項式回歸
4. 取得儀器特徵參數 $U$、$V$、$W$

### 5.4 電鍍銅專用樣品展寬分離

對於電鍍銅常用的 **Pseudo-Voigt 峰型**，採用幾何近似法：

$$\beta_{sample} = \beta_{obs} - \frac{\beta_{inst}^2}{\beta_{obs}}$$

| 有效性條件 | 精度 |
|------------|------|
| $\beta_{obs} > 1.2 \times \beta_{inst}$ | 誤差 < 1% |
| $\beta_{obs} \leq 1.2 \times \beta_{inst}$ | **標記為不可靠** |

---

## 6. 預處理流程總結

```
原始數據
    │
    ▼
┌──────────────┐
│ 數據讀取     │ ← 支援 .txt, .xy, .csv
└──────────────┘
    │
    ▼
┌──────────────┐
│ 平滑化       │ ← Savitzky-Golay (窗口 11, 階數 3)
└──────────────┘
    │
    ▼
┌──────────────┐
│ 背景扣除     │ ← Chebyshev 或 Sonneveld-Visser
└──────────────┘
    │
    ▼
┌──────────────┐
│ Kα₂ 剝離     │ ← Rachinger Correction (選用)
└──────────────┘
    │
    ▼
預處理完成，進入峰值擬合
```

---

## 7. AXCSAS 預處理參數標準

| 參數 | 預設值 | 單位 |
|------|--------|------|
| X-ray 波長 | 1.54056 | Å |
| 平滑窗口 | 11 | 點 |
| 平滑階數 | 3 | - |
| 背景方法 | Chebyshev | - |
| 背景多項式階數 | 5 | - |
| Kα₂ 剝離 | 啟用 | - |
| 有效性閾值 | 1.2 | $\beta_{obs}/\beta_{inst}$ |

---

*上一章：01_樣品製備與背景知識.md*
*下一章：03_峰值擬合與參數提取.md*

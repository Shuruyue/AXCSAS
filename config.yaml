# =============================================================================
# AXCSAS Configuration File
# Advanced XRD Crystallite Size Analysis System
# =============================================================================

# -----------------------------------------------------------------------------
# Physical Constants (Locked for Academic Consistency)
# References:
#   Bearden, J.A. (1967). X-Ray Wavelengths. Rev. Mod. Phys. 39, 78-124.
#   Langford, J.I. & Wilson, A.J.C. (1978). Scherrer after Sixty Years.
#       J. Appl. Cryst. 11, 102-113.
# -----------------------------------------------------------------------------
physical_constants:
  wavelength: 1.540562         # Cu Ka1 (Bearden 1967, Table V, p.9)
  wavelength_ka2: 1.544390     # Cu Ka2 (Bearden 1967, Table V, p.9)
  ka2_ratio: 0.5               # I(Ka2) / I(Ka1) (Burger-Dorgelo rule)
  
  # Scherrer constant K_w for FWHM definition
  scherrer_k:
    spherical: 0.829           # L&W 1978, p.107, K_w for sphere
    cubic: 0.94                # Warren (1969), general cubic approximation
    default: 0.829             # L&W 1978 spherical standard

# -----------------------------------------------------------------------------
# Instrument Parameters (Caglioti Equation)
# Calibrate using: scripts/calibrate_instrument.py
# -----------------------------------------------------------------------------
instrument:
  # FWHM²_inst = U·tan²θ + V·tanθ + W
  caglioti:
    U: null                    # To be calibrated (deg²)
    V: null                    # To be calibrated (deg²)
    W: null                    # To be calibrated (deg²)
  
  # Standard reference materials
  standard: "NIST SRM 660c"    # LaB6

# -----------------------------------------------------------------------------
# Preprocessing Parameters
# -----------------------------------------------------------------------------
preprocessing:
  # Savitzky-Golay Smoothing
  smoothing:
    enable: true
    method: "savgol"
    window_size: 11            # Must be odd (5-15 recommended)
    poly_order: 3              # Polynomial order (2-3 recommended)
  
  # Background Subtraction
  background:
    enable: true
    method: "chebyshev"        # Options: "chebyshev", "sonneveld_visser"
    poly_degree: 5             # For Chebyshev method
  
  # Kα2 Stripping (Rachinger Correction)
  kalpha_strip:
    enable: true
    method: "rachinger"

# -----------------------------------------------------------------------------
# Peak Fitting Parameters
# -----------------------------------------------------------------------------
fitting:
  function: "pseudo_voigt"     # Options: "pseudo_voigt", "voigt", "gaussian", "lorentzian"
  optimizer: "levenberg_marquardt"
  
  # Optimization settings
  max_iterations: 1000
  tolerance: 1.0e-8
  
  # Peak detection
  peak_detection:
    method: "second_derivative"
    min_height: 100            # Minimum peak intensity
    min_distance: 0.5          # Minimum distance between peaks (deg)

# -----------------------------------------------------------------------------
# Validation & Error Analysis
# -----------------------------------------------------------------------------
validation:
  # Instrumental broadening correction threshold
  # When β_obs < threshold × β_inst, result is flagged as unreliable
  min_broadening_ratio: 1.2
  
  # Goodness of fit threshold (%)
  max_rwp: 10.0
  
  # Physical size limits (nm)
  size_limits:
    min_reliable: 2            # Below this: precision issues
    max_reliable: 200          # Above this: exceeds detection limit

# -----------------------------------------------------------------------------
# Output Settings
# -----------------------------------------------------------------------------
output:
  results_format: "csv"        # Options: "csv", "json", "xlsx"
  plot_format: "png"           # Options: "png", "svg", "pdf"
  plot_dpi: 1200
  generate_report: true
  report_format: "markdown"    # Options: "markdown", "pdf"
  
  # Standardized Output Paths
  paths:
    root: "outputs"
    plots: "outputs/plots"
    reports: "outputs/reports"
    cache: "outputs/cache"

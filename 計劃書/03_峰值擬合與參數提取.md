# AXCSAS 計畫書 03：峰值擬合與參數提取

**電鍍銅 XRD 分析系統 - 第三章**

---

## 1. 峰型函數選擇

### 1.1 真實 XRD 峰的物理組成

電鍍銅的 XRD 峰型是多重物理效應的卷積：

| 展寬來源 | 峰型特徵 | 主要貢獻 |
|----------|----------|----------|
| 晶粒尺寸有限性 | **Lorentzian** | 相干散射域限制 |
| 微觀應變分布 | **Gaussian** | 晶格畸變 |
| 儀器光學系統 | Gaussian | 幾何寬化 |

### 1.2 為什麼選擇 Pseudo-Voigt

電鍍銅的峰型既非純 Gaussian 也非純 Lorentzian，**Pseudo-Voigt (pV)** 函數是學術界公認最接近真實繞射行為的描述：

$$I(2\theta) = I_0 \cdot \left[ \eta \cdot L(2\theta) + (1-\eta) \cdot G(2\theta) \right] + Background$$

| 分量 | 函數 | 物理來源 |
|------|------|----------|
| $L(2\theta)$ | Lorentzian | 晶粒尺寸效應 |
| $G(2\theta)$ | Gaussian | 微觀應變 + 儀器 |
| $\eta$ | 混合參數 | 反映兩者比例 |

---

## 2. Pseudo-Voigt 函數詳解

### 2.1 數學形式

**Lorentzian 函數**：
$$L(2\theta) = \frac{1}{1 + \left(\frac{2\theta - 2\theta_c}{w_L}\right)^2}$$

**Gaussian 函數**：
$$G(2\theta) = \exp\left[-\ln 2 \cdot \left(\frac{2\theta - 2\theta_c}{w_G}\right)^2\right]$$

**Pseudo-Voigt 組合**：
$$pV(2\theta) = \eta \cdot L(2\theta) + (1-\eta) \cdot G(2\theta)$$

### 2.2 參數說明

| 參數 | 符號 | 物理意義 | 約束 |
|------|------|----------|------|
| 峰中心 | $2\theta_c$ | Bragg 角位置 | 正值 |
| 峰強度 | $I_0$ | 最大強度 | > 0 |
| 半高全寬 | $w$ (FWHM) | 峰展寬量測 | > 0 |
| 混合參數 | $\eta$ | Lorentzian 比例 | **0 < η < 1** |

### 2.3 η 值的物理意義

| η 值 | 解讀 |
|------|------|
| η → 0 | 接近純 Gaussian（儀器/應變主導）|
| η → 1 | 接近純 Lorentzian（晶粒尺寸主導）|
| 0.3 - 0.7 | 典型電鍍銅（混合效應）|

---

## 3. Levenberg-Marquardt 擬合演算法

### 3.1 演算法選擇

AXCSAS 採用 **Levenberg-Marquardt (LM)** 演算法進行非線性最小平方擬合，取代傳統手動 Origin 擬合。

**優點**：
- 自動化、可重複
- 同時優化多參數
- 收斂快速

### 3.2 擬合流程

```
輸入：預處理後圖譜
    │
    ▼
┌──────────────────┐
│ 峰值檢測         │ ← 二階導數法找峰頂
│ (Peak Detection) │
└──────────────────┘
    │
    ▼
┌──────────────────┐
│ 初始猜測         │ ← 自動估計參數起始值
│ (Initial Guess)  │
└──────────────────┘
    │
    ▼
┌──────────────────┐
│ LM 迭代優化      │ ← 最小化殘差平方和
│ (Iteration)      │
└──────────────────┘
    │
    ▼
輸出：擬合參數 + 品質指標
```

### 3.3 目標函數

最小化殘差平方和 (Residual Sum of Squares, RSS)：

$$RSS = \sum_{i=1}^{N} \left( I_{obs}(2\theta_i) - I_{calc}(2\theta_i) \right)^2$$

---

## 4. 峰值檢測

### 4.1 二階導數法

利用二階導數識別峰頂位置：

$$\frac{d^2 I}{d(2\theta)^2} < 0 \quad \text{且為局部最小}$$

### 4.2 檢測參數

| 參數 | 建議值 | 說明 |
|------|--------|------|
| 最小峰高 | 100 counts | 排除雜訊誤判 |
| 最小峰間距 | 0.5° | 避免重複檢測 |
| 平滑預處理 | 啟用 | 減少雜訊干擾 |

### 4.3 電鍍銅預期峰位

對於 Cu Kα₁ 輻射源，預期檢測到的主要峰：

| 預期峰 (hkl) | 2θ 範圍 (°) |
|--------------|-------------|
| (111) | 43.0 - 43.6 |
| (200) | 50.2 - 50.8 |
| (220) | 73.8 - 74.4 |
| (311) | 89.6 - 90.3 |

---

## 5. 初始參數估計

### 5.1 自動估計策略

| 參數 | 估計方法 |
|------|----------|
| $2\theta_c$ | 二階導數極小位置 |
| $I_0$ | 局部最大強度值 |
| $w$ (FWHM) | 半高點間距估計 |
| $\eta$ | 預設 0.5 |

### 5.2 初始值品質影響

好的初始值對 LM 收斂至關重要：
- 差的初始值 → 可能收斂到局部最小
- 好的初始值 → 快速收斂到全局最小

---

## 6. 擬合輸出參數

### 6.1 每個峰的輸出

| 參數 | 符號 | 說明 | 精度 |
|------|------|------|------|
| 峰中心 | $2\theta_c$ | 精確角度位置 | 小數點後三位 |
| 峰高度 | $H$ | 峰值強度 | 整數 |
| 半高全寬 | $FWHM$ | 峰展寬 | 小數點後三位 |
| 混合參數 | $\eta$ | L/G 比例 | 0-1 |
| 積分強度 | $A$ | 峰下面積 | - |

### 6.2 hkl 指派

根據峰位置與 JCPDS 04-0836 對照：

| 測得 2θ (°) | 指派 hkl |
|-------------|----------|
| 43.0 - 43.6 | (111) |
| 50.2 - 50.8 | (200) |
| 73.8 - 74.4 | (220) |
| 89.6 - 90.3 | (311) |

> **注意**：電鍍銅的峰位可能因殘餘應力而偏移，偏移量 |Δ2θ| < 0.5° 屬正常

---

## 7. 擬合品質評估

### 7.1 Weighted Profile R-factor ($R_{wp}$)

$$R_{wp} = \sqrt{\frac{\sum w_i (I_{obs,i} - I_{calc,i})^2}{\sum w_i \cdot I_{obs,i}^2}} \times 100\%$$

| $R_{wp}$ | 品質判定 |
|----------|----------|
| ≤ 5% | 優秀 |
| 5% - 10% | 良好（可接受）|
| **> 10%** | **Low Confidence（需檢查）** |

### 7.2 擬合失敗常見原因

| 問題 | 可能原因 | 解決方案 |
|------|----------|----------|
| $R_{wp}$ 過高 | 背景扣除不當 | 調整背景參數 |
| 收斂失敗 | 初始值偏離 | 手動調整起始參數 |
| 峰形不對稱 | Kα₂ 未剝離 | 啟用 Rachinger 校正 |
| 峰形異常寬 | 儀器問題 | 檢查儀器對準 |

---

## 8. Kα₁/Kα₂ 雙峰處理

### 8.1 高角度雙峰問題

在 2θ > 60° 區域，Kα₁/Kα₂ 分裂明顯：

| 峰 | Kα₁ 位置 | Kα₂ 位置 | 間距 |
|----|----------|----------|------|
| (220) | 74.13° | ~74.3° | ~0.17° |
| (311) | 89.93° | ~90.2° | ~0.27° |

### 8.2 處理策略

**策略一**：Rachinger 剝離（推薦）
- 預處理階段移除 Kα₂
- 擬合單一 Kα₁ 峰

**策略二**：雙峰擬合
- 固定強度比 $I_{K\alpha_2}/I_{K\alpha_1} = 0.5$
- 固定波長差
- 同時擬合兩峰

---

## 9. 擬合結果範例

### 9.1 輸出格式

```
=== Peak Fitting Results ===
Sample: Cu_Electroplated_5min
Date: 2026-01-09

| Peak | 2θ (°)  | FWHM (°) | η     | I₀    | R_wp (%) |
|------|---------|----------|-------|-------|----------|
| (111)| 43.324  | 0.252    | 0.45  | 15680 | 4.2      |
| (200)| 50.451  | 0.283    | 0.51  | 7250  | 3.8      |
| (220)| 74.156  | 0.318    | 0.48  | 3120  | 5.1      |
| (311)| 89.968  | 0.345    | 0.52  | 2680  | 6.3      |

Overall R_wp: 4.8% ✓ GOOD
```

### 9.2 輸出用途

擬合結果將用於：
- **04章**：Scherrer 晶粒尺寸計算
- **05章**：Williamson-Hall 分析
- **06章**：織構係數計算

---

## 10. 參數標準表

| 項目 | AXCSAS 預設 |
|------|-------------|
| 擬合函數 | Pseudo-Voigt |
| 演算法 | Levenberg-Marquardt |
| 峰檢測 | 二階導數法 |
| 最小峰高 | 100 counts |
| 最小峰距 | 0.5° |
| η 初始值 | 0.5 |
| 收斂容差 | 1×10⁻⁶ |
| 最大迭代 | 1000 |
| $R_{wp}$ 閾值 | 10% |

---

*上一章：02_XRD數據採集與預處理.md*
*下一章：04_晶粒尺寸計算_上篇_Scherrer.md*
